---
import Icon from "./Icon.astro";

interface Props {
	type?: "note" | "tip" | "warning" | "danger";
	title?: string;
	icon?: string;
	collapsible?: boolean;
	collapsed?: boolean;
}

const {
	type = "note",
	title,
	icon,
	collapsed = false,
	collapsible = false,
} = Astro.props;

const configs = {
	note: {
		colorClass: "text-brand-light border-l-brand-light bg-brand-light/10",
		iconName: "note",
		defaultTitle: "Note",
	},
	tip: {
		colorClass: "text-brand border-l-brand bg-brand/10",
		iconName: "tip",
		defaultTitle: "Tip",
	},
	warning: {
		colorClass: "text-brand-dark border-l-brand-dark bg-brand-dark/10",
		iconName: "warning",
		defaultTitle: "Warning",
	},
	danger: {
		colorClass: "text-red-500 border-l-red-500 bg-red-500/10",
		iconName: "danger",
		defaultTitle: "Danger",
	},
};

const config = configs[type] || configs.note;
const finalIconName = icon || config.iconName;
const finalTitle = title || config.defaultTitle;

const containerClass = `my-6 w-full rounded-r-lg border-l-4 p-4 ${config.colorClass} border-opacity-100 bg-opacity-20 border border-text-muted/50`;
const headerClass = "flex items-center gap-2 font-bold font-mono text-base select-none mb-2";
---

{collapsible ? (
	<details open={!collapsed} class=`${containerClass} group`>
		<summary class=`${headerClass} cursor-pointer list-none flex items-center justify-between [&::-webkit-details-marker]:hidden`>
			<div class="gap-2 flex items-center">
				<div class="text-lg leading-none">
					<Icon name={finalIconName} size={16} class="w-5 h-5" />
				</div>
				<span>
					{finalTitle}
				</span>
			</div>

			<svg 
				xmlns="http://www.w3.org/2000/svg" 
				width="20" height="20" 
				viewBox="0 0 24 24" 
				fill="none" 
				stroke="currentColor" 
				stroke-width="2" 
				stroke-linecap="round" 
				stroke-linejoin="round"
				class="text-text-muted opacity-50 transition-transform duration-200 group-open:rotate-180"
			>
				<polyline points="6 9 12 15 18 9"></polyline>
			</svg>
		</summary>

		<div class="prose-p:my-0 text-text-main mt-0">
			<slot />
		</div>
	</details>
) : (
	<div class={containerClass}>
		<div class={headerClass}>
			<div class="text-lg leading-none">
				<Icon name={finalIconName} size={16} class="w-5 h-5" />
			</div>
			<span>
				{finalTitle}
			</span>
		</div>

		<div class="prose-p:my-0 text-text-main mt-0">
			<slot />
		</div>
	</div>
)}